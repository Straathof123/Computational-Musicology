---
title: "The Djesse Albums"
author: "Lucas Straathof"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical layout: scroll
    storyboard: true 
    theme: journal
---

```{r, include=FALSE}
library(tidyverse)
library(tidymodels)
library(compmus)
library(protoclust)
library(cowplot)
library(spotifyr)
library(ggplot2)
library(plotly)
library(dplyr)
library(ggdendro)
library(heatmaply)

get_conf_mat <- function(fit) {outcome <- .get_tune_outcome_names(fit)
  fit |> 
    collect_predictions() |> 
    conf_mat(truth = outcome, estimate = .pred_class)
}  

get_pr <- function(fit) {
  fit |> 
    conf_mat_resampled() |> 
    group_by(Prediction) |> mutate(precision = Freq / sum(Freq)) |> 
    group_by(Truth) |> mutate(recall = Freq / sum(Freq)) |> 
    ungroup() |> filter(Prediction == Truth) |> 
    select(class = Prediction, precision, recall)
}  

```

```{r, include=FALSE}
djesse1 <- get_playlist_audio_features("", "55AhOVOznsMmppxhkhQeox")
djesse2 <- get_playlist_audio_features("", "2ySg6xH1guPJ6WacYBnEtE")
djesse3 <- get_playlist_audio_features("", "4y0xPsPUbwmsf32r8GiETo")
djesse4 <- get_playlist_audio_features("", "23CJn0kvWIvoEg6VlbGeGl")
djesse3_4 <- bind_rows(djesse3, djesse4) |> 
  add_audio_analysis()
all_albums <- bind_rows(djesse1, djesse2, djesse3, djesse4)
```



### Home - The Djesse Albums

Welcome to my page about the wonderful albums of Jacob Collier, called Djesse. This series of albums covers tons of genres and are completely different from each other. In this research, I'm going to dive deeper into these albums, seeing if there are comparisons to be made, or to see if they are completely different. 

There is a fourth Djesse album on its way and will be released at the end of February, but I think it’s easier to analyze if I can start right away, seeing as we're still in the middle of February as of the point we started this course. I might change this if it becomes clear that I can easily include it into my corpus

I really like Jacob Collier’s music and am a big fan. His Djesse albums especially blow me out of the water each time. His music is so different from anyone else’s. He has his very distinct style which is instantly recognizable. Jacob Collier is his own genre within music in a way. 

The comparisons will be within the albums themselves. I find it interesting to discover if there is a difference between the Djesse albums in a way I haven't discovered before. I’m expecting that there will be a constant theme within a single album, but differences between the few. 

The thing that I think is going to be the most troubling, is the fact that there are not that many songs,  around 50 actually. This will become an issue if it shows that I need more data to do the research. For example, if I’m seeing a correlation, but that correlation is dependent on 2 or 3 songs being the same in a way, that isn’t much evidence. With more songs, this evidence would be stronger. 

I think the biggest outlying song will be ‘Moon River’ on Djesse vol. 2. This song was completely sung acapella and is very different from everything else on the albums, even though every single thing Jacob Collier makes is varying in every aspect.


This is a test



### The Albums

In 2018, Collier began working on Djesse, a four-volume, 50-song album featuring more than two dozen artists and ensembles. The first volume, which features the Metropole Orkest, Djesse Vol. 1, was released in December 2018. The second, Djesse Vol. 2, uses more acoustic instrumentation, and was released in July 2019. In 2020, Collier won Grammy Awards for his arrangements of "All Night Long (All Night)" from Djesse Vol. 1 and "Moon River" from Djesse Vol. 2. In 2021, he won a Grammy Award for "He Won't Hold You" from the third volume, Djesse Vol. 3. 

[Wikipedia Page](https://en.wikipedia.org/wiki/Jacob_Collier)



### First Comparison

```{r, include=FALSE}
energy_of_all <- ggplot(all_albums, aes(x=energy, fill=playlist_name, alpha = 0.3)) +
  geom_density() +
  scale_x_continuous(breaks = seq(0, 1, by = 0.1)) +
  facet_wrap(~ factor(playlist_name, levels = c('Djesse Vol. 1', 'Djesse Vol. 2', 'Djesse Vol. 3', 'Djesse Vol. 4'))) +
  theme_classic()
```

```{r}
ggplotly(energy_of_all)
```

***

In this first graph, we compare the energy of all the albums. And we can see a few differences. 
First of all, Djesse Vol. 3 seems to be the most energetic overall, with nothing going beneath the 0.3 energy range. 
Secondly, Djesse Vol. 2 is very spread out. There are songs on all parts of the graph.



### Dendogram

```{r}
replace_track_names <- function(track_name) {
  track_name <- gsub("Pt\\. 1", "Part 1", track_name)
  track_name <- gsub("Pt\\. 2", "Part 2", track_name)
  track_name <- gsub("^(.*?) (.*)$", "\\2 \\1", track_name)
  return(track_name)}

djesse3_4$track.name <- sapply(djesse3_4$track.name, replace_track_names)
```


```{r}
djesse_3_4_dendogram_computed <-
  recipe(
    track.name ~
      danceability + energy + loudness + speechiness + acousticness + 
      instrumentalness + liveness + valence + tempo,
    data = djesse3_4
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(djesse3_4 |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

djesse_3_4_dendogram_computed <- dist(djesse_3_4_dendogram_computed, method = "euclidean")

data_for_djesse_clustering <- djesse_3_4_dendogram_computed |> 
  hclust(method = "average") |> # average for a balanced tree!
  dendro_data() 

playlist_data_for_join <- djesse3_4 %>%
  select(track.name, playlist_name) %>%
  mutate(label = str_trunc(track.name, 20))

data_for_djesse_clustering$labels <- data_for_djesse_clustering$labels %>%
  left_join(playlist_data_for_join)

data_for_djesse_clustering$labels$label <- factor(data_for_djesse_clustering$labels$label)
```

```{r}
plot_dendogram <- data_for_djesse_clustering |>
  ggdendrogram() +
  geom_text(data = label(data_for_djesse_clustering), aes(x, y, 
                                   label=label, 
                                   hjust=0, 
                                   colour=playlist_name), size=3) +
  coord_flip() + 
  scale_y_reverse(expand=c(0.2, 0)) +
  theme(axis.line.y=element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.y=element_blank(),
        axis.title.y=element_blank(),
        panel.background=element_rect(fill="white"),
        panel.grid=element_blank()) +
  labs(title = "Playlist Clustering for Djesse Vol. 3 and 4") +
  guides(
    colour = guide_legend(
      title = "Playlist"
    )
  )
```

```{r, fig.width=10, fig.height=6}
plot_dendogram
```


***

In this dendogram, I wanted to compare the albums Djesse Vol. 3 and Vol. 4, because these two graphs looked very similar in the previous storyboard where I plotted the density of the energy. 

The first thing I noticed, is that (at the bottom) the songs '[World O World](https://open.spotify.com/track/32uchtKD304d7YYOAlN9DM?si=153d20a4591f43a4)' and '[Bridge over Troubled Water](https://open.spotify.com/track/4asa5agcZmibrmpTmb1q6m?si=c39b1da0966c48c5)' are very similar and this makes sense, because these songs are both purely acapella sung. 2 more songs which make sense to be next to each other, are '[Wherever I go](https://open.spotify.com/track/1G9EQgDHJpQngoQLYKZYmu?si=3d08faa840524e23)' and '[Sleeping on my Dreams](https://open.spotify.com/track/4mTd21pyWajN252LcouVIm?si=c2eca7d0fb4e4be9)', which are both a classic case of a regular pop song, just like '[She Put Sunshine](https://open.spotify.com/track/60ZCmLIYDUHmQ98Ydo1cR8?si=7bcd3f2310f44fca)', which is also very close. 

The things I don't get why they are close together, are '[100.000 Voices](https://open.spotify.com/track/4RenR9s7VhyzHVHMdTmjx2?si=7377ca46ae2140ef)' Voices and '[Box of Stars Pt. 2](https://open.spotify.com/track/232QdHfiXCR7dqhScytiYN?si=36a1bcbea4fa41bd)'. Except for the fact that some lyrics are in both songs and the structure is not typical, there are not that many similarities. 100.000 Voices starts with a big choir, then continues into a poppy song and ends with a hardcore section. Box of Stars Pt. 2 is very much focused on different rhythms from around the world and ends with a big choir with a distorted electric guitar. 

We can also see that most clusters are within a single album and not between the two albums. This proves that these albums are less similar than previously thought, like I suggested on the previous storyboard. 



